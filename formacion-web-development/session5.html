<!DOCTYPE html>
<html lang="es">
  <head>
    <!-- El head se inyecta autom√°ticamente desde script.js -->
    <link rel="stylesheet" href="../index.css" />
    <link rel="stylesheet" href="../slide-styles.css" />
    <style>
      /* Custom styles para esta sesi√≥n - colores naranjas */
    </style>
  </head>
  <body>
    <div id="slides-container">
      <!-- Slide 1: Portada -->
      <section class="slide slide-cover active">
        <div class="step visible">
          <h1 class="slide-title">üåê SESI√ìN 5</h1>
        </div>
        <div class="step">
          <p class="subtitle">APIs y comunicaci√≥n as√≠ncrona</p>
        </div>
      </section>

      <!-- Slide 2: ¬øQu√© es una API? -->
      <section class="slide slide-content">
        <h2 class="slide-title">üîå ¬øQu√© es una API?</h2>
        <div class="content">
          <div class="step">
            <p><strong>API</strong> = Application Programming Interface</p>
            <p>
              Es un "camarero" que lleva tu pedido (request) a la cocina
              (servidor) y te trae la comida (response) üçΩÔ∏è
            </p>
          </div>
          <div class="step">
            <p><strong>APIs REST:</strong> El est√°ndar m√°s com√∫n</p>
            <ul>
              <li>Usan HTTP (GET, POST, PUT, DELETE)</li>
              <li>Devuelven datos en formato JSON</li>
              <li>Stateless (cada petici√≥n es independiente)</li>
            </ul>
          </div>
          <div class="step">
            <div class="highlight-box">
              <strong>üí° Ejemplo real:</strong>
              Cuando consultas el tiempo en una app, hace una petici√≥n a una API
              meteorol√≥gica
            </div>
          </div>
        </div>
      </section>

      <!-- Slide 3: HTTP Methods -->
      <section class="slide slide-table">
        <h2 class="slide-title">üì° M√©todos HTTP principales</h2>
        <div class="step">
          <table>
            <thead>
              <tr>
                <th>M√©todo</th>
                <th>Acci√≥n</th>
                <th>Ejemplo</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>GET</strong></td>
                <td>Obtener datos</td>
                <td>Listar usuarios</td>
              </tr>
              <tr>
                <td><strong>POST</strong></td>
                <td>Crear nuevo</td>
                <td>Crear usuario</td>
              </tr>
              <tr>
                <td><strong>PUT</strong></td>
                <td>Actualizar completo</td>
                <td>Actualizar perfil</td>
              </tr>
              <tr>
                <td><strong>PATCH</strong></td>
                <td>Actualizar parcial</td>
                <td>Cambiar email</td>
              </tr>
              <tr>
                <td><strong>DELETE</strong></td>
                <td>Eliminar</td>
                <td>Borrar usuario</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Slide 4: C√≥digo s√≠ncrono vs as√≠ncrono -->
      <section class="slide slide-comparison">
        <h2 class="slide-title">‚è±Ô∏è S√≠ncrono vs As√≠ncrono</h2>
        <div class="comparison-container">
          <div class="step comparison-side bad">
            <div class="comparison-header">
              <span class="comparison-icon">üêå</span>
              <span>C√≥digo S√≠ncrono</span>
            </div>
            <div class="comparison-content">
              <pre>
console.log("1. Inicio");

// Bloquea todo durante 3 segundos
esperarTresSegundos(); 

console.log("2. Fin");
// "Fin" se ejecuta despu√©s de 3 seg</pre
              >
              <ul>
                <li>Ejecuta l√≠nea por l√≠nea</li>
                <li>Bloquea la ejecuci√≥n</li>
                <li>Mala experiencia de usuario</li>
              </ul>
            </div>
          </div>
          <div class="step comparison-side good">
            <div class="comparison-header">
              <span class="comparison-icon">‚ö°</span>
              <span>C√≥digo As√≠ncrono</span>
            </div>
            <div class="comparison-content">
              <pre>
console.log("1. Inicio");

// No bloquea, contin√∫a
setTimeout(() => {
  console.log("3. Despu√©s de 3 seg");
}, 3000);

console.log("2. Fin inmediato");</pre
              >
              <ul>
                <li>No espera a terminar</li>
                <li>No bloquea nada</li>
                <li>Mejor experiencia</li>
              </ul>
            </div>
          </div>
        </div>
      </section>

      <!-- Slide 5: Promesas -->
      <section class="slide slide-code">
        <h2 class="slide-title">ü§ù Promesas en JavaScript</h2>
        <div class="step">
          <pre>
// Una promesa representa un valor futuro
const miPromesa = new Promise((resolve, reject) => {
  const exito = true;
  
  if (exito) {
    resolve("¬°Todo bien!"); // Promesa cumplida
  } else {
    reject("Algo fall√≥"); // Promesa rechazada
  }
});

// Usar la promesa
miPromesa
  .then(resultado => {
    console.log(resultado); // "¬°Todo bien!"
  })
  .catch(error => {
    console.error(error);
  });</pre
          >
        </div>
        <div class="step">
          <div class="explanation">
            <strong>Estados:</strong> pending (esperando) ‚Üí fulfilled (√©xito) o
            rejected (error)
          </div>
        </div>
      </section>

      <!-- Slide 6: async/await -->
      <section class="slide slide-code">
        <h2 class="slide-title">‚ú® async/await - Sintaxis moderna</h2>
        <div class="step">
          <pre>
// Funci√≥n as√≠ncrona
async function obtenerDatos() {
  try {
    // await espera a que la promesa se resuelva
    const resultado = await miPromesa;
    console.log(resultado);
    
    const otroDato = await otraPromesa;
    return otroDato;
    
  } catch (error) {
    console.error("Error:", error);
  }
}

// Llamar funci√≥n as√≠ncrona
obtenerDatos();</pre
          >
        </div>
        <div class="step">
          <div class="explanation">
            <strong>‚úÖ Ventajas:</strong> C√≥digo m√°s limpio, parece s√≠ncrono
            pero no bloquea
          </div>
        </div>
      </section>

      <!-- Slide 7: fetch() - La forma moderna -->
      <section class="slide slide-code">
        <h2 class="slide-title">üé£ fetch() - Consumir APIs</h2>
        <div class="step">
          <pre>
// GET request
async function obtenerUsuarios() {
  try {
    const response = await fetch('https://api.ejemplo.com/usuarios');
    
    if (!response.ok) {
      throw new Error('Error en la petici√≥n');
    }
    
    const datos = await response.json();
    console.log(datos);
    return datos;
    
  } catch (error) {
    console.error('Error:', error);
  }
}</pre
          >
        </div>
      </section>

      <!-- Slide 8: fetch() POST -->
      <section class="slide slide-code">
        <h2 class="slide-title">üì§ fetch() - Enviar datos (POST)</h2>
        <div class="step">
          <pre>
async function crearUsuario(usuario) {
  try {
    const response = await fetch('https://api.ejemplo.com/usuarios', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(usuario)
    });
    
    const nuevoUsuario = await response.json();
    console.log('Usuario creado:', nuevoUsuario);
    return nuevoUsuario;
    
  } catch (error) {
    console.error('Error:', error);
  }
}

// Usar
crearUsuario({ nombre: "Ana", email: "ana@test.com" });</pre
          >
        </div>
      </section>

      <!-- Slide 9: Flujo tradicional HTTP -->
      <section class="slide slide-timeline">
        <h2 class="slide-title">üîÑ Flujo tradicional: Request-Response</h2>
        <div class="timeline-container">
          <div class="timeline-horizontal">
            <div class="step timeline-step">
              <span class="timeline-step-icon">üåê</span>
              <div class="timeline-step-number">1</div>
              <div class="timeline-step-title">Cliente hace petici√≥n</div>
              <div class="timeline-step-description">
                fetch() env√≠a request al servidor
              </div>
            </div>
            <div class="step timeline-step">
              <span class="timeline-step-icon">‚öôÔ∏è</span>
              <div class="timeline-step-number">2</div>
              <div class="timeline-step-title">Servidor procesa</div>
              <div class="timeline-step-description">
                Backend ejecuta l√≥gica y consulta BD
              </div>
            </div>
            <div class="step timeline-step">
              <span class="timeline-step-icon">üì¶</span>
              <div class="timeline-step-number">3</div>
              <div class="timeline-step-title">Servidor responde</div>
              <div class="timeline-step-description">
                Devuelve datos en JSON
              </div>
            </div>
            <div class="step timeline-step">
              <span class="timeline-step-icon">‚úÖ</span>
              <div class="timeline-step-number">4</div>
              <div class="timeline-step-title">Cliente recibe</div>
              <div class="timeline-step-description">
                Procesa respuesta y actualiza UI
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Slide 10: Ejemplo flujo tradicional -->
      <section class="slide slide-code">
        <h2 class="slide-title">üíª Ejemplo: Flujo tradicional completo</h2>
        <div class="step">
          <pre>
// Cliente (Frontend)
async function obtenerProductos() {
  // 1. Cliente hace petici√≥n GET
  const response = await fetch('https://api.tienda.com/productos');
  
  // 4. Cliente recibe respuesta
  const productos = await response.json();
  
  // Actualizar interfaz
  mostrarProductos(productos);
}

// Servidor (Backend - Concepto)
// 2. Servidor procesa
// app.get('/productos', async (req, res) => {
//   const productos = await database.query('SELECT * FROM productos');
//   
//   3. Servidor responde
//   res.json(productos);
// });</pre
          >
        </div>
        <div class="step">
          <div class="explanation">
            <strong>‚úÖ Perfecto para:</strong> Consultas puntuales, operaciones
            CRUD
          </div>
        </div>
      </section>

      <!-- Slide 11: Limitaci√≥n del flujo tradicional -->
      <section class="slide slide-quote quote-warning">
        <div class="step">
          <span class="quote-icon">‚ö†Ô∏è</span>
        </div>
        <div class="step">
          <p class="quote-text">
            El flujo Request-Response tradicional NO es eficiente para datos en
            tiempo real
          </p>
        </div>
        <div class="step">
          <p class="quote-author">
            ‚Äî El cliente debe hacer polling (consultar constantemente)
          </p>
        </div>
      </section>

      <!-- Slide 12: EventSource y SSE -->
      <section class="slide slide-content">
        <h2 class="slide-title">üì° EventSource y Server-Sent Events (SSE)</h2>
        <div class="content">
          <div class="step">
            <p>
              <strong>SSE</strong> permite que el servidor env√≠e datos al
              cliente autom√°ticamente üéØ
            </p>
          </div>
          <div class="step">
            <p><strong>Caracter√≠sticas:</strong></p>
            <ul>
              <li>Conexi√≥n persistente unidireccional (servidor ‚Üí cliente)</li>
              <li>Eventos en tiempo real sin polling</li>
              <li>Reconexi√≥n autom√°tica</li>
              <li>Protocolo simple sobre HTTP</li>
            </ul>
          </div>
          <div class="step">
            <div class="highlight-box">
              <strong>üí° Casos de uso:</strong>
              Notificaciones, feeds en tiempo real, progreso de tareas,
              actualizaciones de estado
            </div>
          </div>
        </div>
      </section>

      <!-- Slide 13: Flujo con EventSource -->
      <section class="slide slide-timeline">
        <h2 class="slide-title">üîÑ Flujo con EventSource (SSE)</h2>
        <div class="timeline-container">
          <div class="timeline-horizontal">
            <div class="step timeline-step">
              <span class="timeline-step-icon">üîå</span>
              <div class="timeline-step-number">1</div>
              <div class="timeline-step-title">Cliente conecta</div>
              <div class="timeline-step-description">
                EventSource abre conexi√≥n persistente
              </div>
            </div>
            <div class="step timeline-step">
              <span class="timeline-step-icon">üëÇ</span>
              <div class="timeline-step-number">2</div>
              <div class="timeline-step-title">Cliente escucha</div>
              <div class="timeline-step-description">
                Espera eventos del servidor
              </div>
            </div>
            <div class="step timeline-step">
              <span class="timeline-step-icon">üì§</span>
              <div class="timeline-step-number">3</div>
              <div class="timeline-step-title">Servidor env√≠a</div>
              <div class="timeline-step-description">
                Push autom√°tico cuando hay datos
              </div>
            </div>
            <div class="step timeline-step">
              <span class="timeline-step-icon">üîÅ</span>
              <div class="timeline-step-number">4</div>
              <div class="timeline-step-title">Ciclo continuo</div>
              <div class="timeline-step-description">
                Se repite mientras est√© conectado
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Slide 14: EventSource c√≥digo cliente -->
      <section class="slide slide-code">
        <h2 class="slide-title">üíª EventSource - C√≥digo Cliente</h2>
        <div class="step">
          <pre>
// Crear conexi√≥n EventSource
const eventSource = new EventSource('https://api.ejemplo.com/eventos');

// Escuchar evento por defecto "message"
eventSource.onmessage = (event) => {
  const datos = JSON.parse(event.data);
  console.log('Datos recibidos:', datos);
  actualizarUI(datos);
};

// Escuchar evento personalizado
eventSource.addEventListener('notificacion', (event) => {
  const notif = JSON.parse(event.data);
  mostrarNotificacion(notif);
});

// Manejar errores
eventSource.onerror = (error) => {
  console.error('Error en conexi√≥n:', error);
};

// Cerrar conexi√≥n cuando no se necesite
// eventSource.close();</pre
          >
        </div>
      </section>

      <!-- Slide 15: EventSource c√≥digo servidor -->
      <section class="slide slide-code">
        <h2 class="slide-title">‚öôÔ∏è SSE - C√≥digo Servidor (Node.js)</h2>
        <div class="step">
          <pre>
// Endpoint SSE en Express
app.get('/eventos', (req, res) => {
  // Configurar headers para SSE
  res.setHeader('Content-Type', 'text/event-stream');
  res.setHeader('Cache-Control', 'no-cache');
  res.setHeader('Connection', 'keep-alive');
  
  // Enviar evento cada 5 segundos
  const intervalo = setInterval(() => {
    const datos = {
      timestamp: new Date().toISOString(),
      valor: Math.random()
    };
    
    // Formato SSE: data: {contenido}\n\n
    res.write(`data: ${JSON.stringify(datos)}\n\n`);
  }, 5000);
  
  // Limpiar cuando cliente desconecta
  req.on('close', () => {
    clearInterval(intervalo);
  });
});</pre
          >
        </div>
      </section>

      <!-- Slide 16: Request-Response vs EventSource -->
      <section class="slide slide-comparison">
        <h2 class="slide-title">‚öñÔ∏è Request-Response vs EventSource</h2>
        <div class="comparison-container">
          <div class="step comparison-side good">
            <div class="comparison-header">
              <span class="comparison-icon">üìû</span>
              <span>Request-Response</span>
            </div>
            <div class="comparison-content">
              <ul>
                <li><strong>‚úÖ</strong> Simple de implementar</li>
                <li><strong>‚úÖ</strong> Bien para operaciones puntuales</li>
                <li><strong>‚úÖ</strong> Cliente controla cu√°ndo pedir</li>
                <li><strong>‚ùå</strong> Ineficiente para tiempo real</li>
                <li><strong>‚ùå</strong> Requiere polling</li>
              </ul>
              <p style="margin-top: 15px">
                <strong>Usa para:</strong> CRUD, consultas, formularios
              </p>
            </div>
          </div>
          <div class="step comparison-side good">
            <div class="comparison-header">
              <span class="comparison-icon">üì°</span>
              <span>EventSource (SSE)</span>
            </div>
            <div class="comparison-content">
              <ul>
                <li><strong>‚úÖ</strong> Push autom√°tico del servidor</li>
                <li><strong>‚úÖ</strong> Eficiente para tiempo real</li>
                <li><strong>‚úÖ</strong> Reconexi√≥n autom√°tica</li>
                <li><strong>‚ùå</strong> Solo servidor ‚Üí cliente</li>
                <li><strong>‚ùå</strong> No para mensajer√≠a bidireccional</li>
              </ul>
              <p style="margin-top: 15px">
                <strong>Usa para:</strong> Notificaciones, feeds, progreso
              </p>
            </div>
          </div>
        </div>
      </section>

      <!-- Slide 17: Ejemplo real combinado -->
      <section class="slide slide-code">
        <h2 class="slide-title">üéØ Ejemplo real: Combinando ambos</h2>
        <div class="step">
          <pre>
// 1. Request-Response para crear tarea
async function crearTarea(tarea) {
  const response = await fetch('/api/tareas', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(tarea)
  });
  
  const nuevaTarea = await response.json();
  return nuevaTarea;
}

// 2. EventSource para recibir progreso en tiempo real
const eventSource = new EventSource(`/api/tareas/${tareaId}/progreso`);

eventSource.onmessage = (event) => {
  const progreso = JSON.parse(event.data);
  actualizarBarraProgreso(progreso.porcentaje);
  
  if (progreso.porcentaje === 100) {
    eventSource.close();
    mostrarCompletado();
  }
};</pre
          >
        </div>
      </section>

      <!-- Slide 18: Buenas pr√°cticas -->
      <section class="slide slide-list">
        <h2 class="slide-title">‚úÖ Buenas pr√°cticas APIs</h2>
        <div class="content">
          <div class="step list-item">
            <div class="number">01</div>
            <div class="text">
              <strong>Siempre maneja errores</strong><br />
              Usa try/catch con async/await, verifica response.ok
            </div>
          </div>
          <div class="step list-item">
            <div class="number">02</div>
            <div class="text">
              <strong>Muestra estados de carga</strong><br />
              Informa al usuario que algo est√° pasando
            </div>
          </div>
          <div class="step list-item">
            <div class="number">03</div>
            <div class="text">
              <strong>Cierra conexiones EventSource</strong><br />
              Usa eventSource.close() cuando ya no las necesites
            </div>
          </div>
          <div class="step list-item">
            <div class="number">04</div>
            <div class="text">
              <strong>Valida datos antes de enviar</strong><br />
              Evita peticiones innecesarias al servidor
            </div>
          </div>
          <div class="step list-item">
            <div class="number">05</div>
            <div class="text">
              <strong>Usa el m√©todo HTTP correcto</strong><br />
              GET para leer, POST para crear, PUT/PATCH para actualizar
            </div>
          </div>
        </div>
      </section>

      <!-- Slide 19: Resumen -->
      <section class="slide slide-summary">
        <h2 class="slide-title">üìù Resumen Sesi√≥n 5</h2>
        <div class="step">
          <div class="summary-box">
            <h3>Has aprendido:</h3>
            <ul>
              <li>Qu√© son las APIs REST y m√©todos HTTP</li>
              <li>Diferencia entre c√≥digo s√≠ncrono y as√≠ncrono</li>
              <li>Promesas y async/await en JavaScript</li>
              <li>fetch() para consumir APIs (GET, POST)</li>
              <li>Flujo tradicional Request-Response</li>
              <li>EventSource y Server-Sent Events (SSE)</li>
              <li>Cu√°ndo usar cada patr√≥n de comunicaci√≥n</li>
            </ul>
            <p style="margin-top: 30px; font-size: 1.2em">
              <strong>Pr√≥xima sesi√≥n:</strong> CSS moderno y responsive design
              üé®
            </p>
          </div>
        </div>
      </section>

      <section class="slide slide-final"></section>
    </div>

    <script src="../script.js"></script>
  </body>
</html>
